<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mental lab</title>
  <style>
    /* 기본 레이아웃 설정 */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #161b22;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .nav {
      display: flex;
      gap: 10px;
      padding: 10px;
      background: #0f141a;
      border-bottom: 1px solid #2f3540;
      flex: 0 0 auto;
    }
    .nav button {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #2f3540;
      background: #1f252f;
      color: #e5e7eb;
      cursor: pointer;
    }
    .nav button.active { background: #e5e7eb; color: #0f141a; }

    /* 메인 컨텐츠 영역 분할 */
    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* 왼쪽 공식 사이드바 */
    .formula-sidebar {
      width: 240px;
      background: #0d1117;
      border-right: 1px solid #2f3540;
      padding: 16px;
      overflow-y: auto;
      font-size: 0.85rem;
      line-height: 1.6;
    }
    .formula-sidebar h3 {
      font-size: 0.95rem;
      color: #8b949e;
      margin-bottom: 12px;
      border-bottom: 1px solid #21262d;
      padding-bottom: 4px;
    }
    .formula-group { margin-bottom: 20px; }
    .formula-item {
      background: #161b22;
      padding: 6px 10px;
      border-radius: 4px;
      margin-bottom: 6px;
      font-family: "Cascadia Code", "Courier New", monospace;
      color: #58a6ff;
      border: 1px solid #30363d;
    }

    /* 중앙 연습 영역 */
    .content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .card {
      max-width: 360px;
      margin: 0 auto 16px;
      background: #1f252f;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .card h2 { margin: 0 0 8px; font-size: 1.2rem; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; align-items: center; }
    .row label { font-size: 0.8rem; display: flex; flex-direction: column; gap: 2px; }
    .row input, .row select { padding: 4px 6px; border-radius: 6px; border: 1px solid #2f3540; background: #161b22; color: #e5e7eb; width: 80px; }
    .row button { padding: 6px 10px; border-radius: 6px; border: 1px solid #2f3540; background: #111827; color: #e5e7eb; cursor: pointer; }

    .problem { font-size: 1.6rem; text-align: center; margin: 14px 0 6px; min-height: 2em; }
    .timer { font-size: 0.9rem; text-align: center; color: #9ca3af; margin-bottom: 8px; }
    .answer-row { display: flex; justify-content: center; gap: 6px; margin-bottom: 8px; }
    .answer-row input { width: 160px; padding: 6px; border-radius: 6px; border: 1px solid #2f3540; background: #161b22; color: #e5e7eb; font-size: 1rem; text-align: center; }
    .answer-row button { padding: 6px 10px; border-radius: 6px; border: 1px solid #2f3540; background: #111827; color: #e5e7eb; cursor: pointer; }
    .result { text-align: center; min-height: 1.6em; font-size: 0.95rem; }
    .result.correct { color: #10b981; }
    .result.wrong { color: #ef4444; }
    .hint { font-size: 0.75rem; text-align: center; color: #9ca3af; margin-top: 4px; }

    #logHint { font-size: 0.8rem; color: #9ca3af; margin-top: 6px; min-height: 1.2em; }
    #toggleLogHint { padding: 4px 8px; font-size: 0.75rem; border-radius: 4px; border: 1px solid #2f3540; background: #1f252f; color: #e5e7eb; cursor: pointer; display: block; margin: 0 auto; }

    .history { max-width: 360px; margin: 10px auto 0; background: #1f252f; border-radius: 10px 10px 0 0; padding: 10px; border-top: 1px solid #2f3540; height: 190px; overflow-y: auto; font-size: 0.85rem; }
    .history-title { font-weight: 600; margin-bottom: 4px; font-size: 0.9rem; }
    .history-item.correct { color: #10b981; }
    .history-item.wrong { color: #ef4444; }

    .graph { max-width: 360px; margin: 0 auto 12px; padding: 6px 10px; background: #1f252f; border-radius: 0 0 10px 10px; border-top: 1px solid #2f3540; }
    .graph-label { font-size: 0.8rem; margin-bottom: 4px; color: #9ca3af; }
    .graph-bars { display: flex; gap: 2px; align-items: flex-end; min-height: 26px; }
    .bar { width: 8px; height: 20px; background: #4b5563; border-radius: 3px; }
    .bar.correct { background: #10b981; }
    .bar.wrong { background: #ef4444; }
  </style>
</head>
<body>

  <div class="nav">
    <button id="navMul" class="active">곱셈</button>
    <button id="navExp">지수(2ⁿ/3ⁿ)</button>
  </div>

  <div class="main-container">
    <div class="formula-sidebar">
      <div class="formula-group">
        <h3>Algebraic</h3>
        <div class="formula-item">(a+b)(a-b) = a²-b²</div>
        <div class="formula-item">(a±b)² = a²±2ab+b²</div>
        <div class="formula-item">(x+a)(x+b) = x²+(a+b)x+ab</div>
      </div>
      <div class="formula-group">
        <h3>Power & Log</h3>
        <div class="formula-item">aᵐ · aⁿ = aᵐ⁺ⁿ</div>
        <div class="formula-item">(aᵐ)ⁿ = aᵐⁿ</div>
        <div class="formula-item">log(xy) = log x + log y</div>
      </div>
      <div class="formula-group">
        <h3>Summation</h3>
        <div class="formula-item">Σk = n(n+1)/2</div>
        <div class="formula-item">Σ(2k-1) = n²</div>
      </div>
    </div>

    <div class="content">
      <div id="mulCard" class="card">
        <h2>곱셈 암산</h2>
        <div class="row">
          <label>왼쪽 <input type="number" id="digitsA" value="2" min="1" max="10" /></label>
          <label>오른쪽 <input type="number" id="digitsB" value="2" min="1" max="10" /></label>
          <button id="mulNew">새 문제</button>
        </div>
        <div class="problem" id="mulProblem">새 문제를 눌러줘.</div>
        <div class="timer" id="mulTimer">시간: 0.00초</div>
        <div class="answer-row">
          <input type="text" id="mulAns" placeholder="답 입력" />
          <button id="mulSubmit">제출</button>
        </div>
        <div class="result" id="mulResult"></div>
        <div class="hint">Space: 새 문제 · Enter: 제출</div>
      </div>

      <div id="expCard" class="card" style="display:none;">
        <h2>지수 암산 (2ⁿ / 3ⁿ)</h2>
        <div class="row">
          <select id="expBase">
            <option value="2">2ⁿ</option>
            <option value="3">3ⁿ</option>
          </select>
          <label>n 최소 <input type="number" id="expNMin" value="1" /></label>
          <label>n 최대 <input type="number" id="expNMax" value="10" /></label>
          <button id="expNew">새 문제</button>
        </div>
        <div class="problem" id="expProblem">범위를 정하고 시작해.</div>
        <div class="timer" id="expTimer">시간: 0.00초</div>
        <div id="logHint"></div>
        <button id="toggleLogHint">로그 힌트 켜기</button>
        <div class="answer-row">
          <input type="text" id="expAns" placeholder="답 입력" />
          <button id="expSubmit">제출</button>
        </div>
        <div class="result" id="expResult"></div>
      </div>

      <div class="history" id="history">
        <div class="history-title">히스토리</div>
      </div>
      <div class="graph">
        <div class="graph-label">최근 결과</div>
        <div class="graph-bars" id="graphBars"></div>
      </div>
    </div>
  </div>

  <script>
    let mode = "mul";
    let timer = null;
    let start = 0;
    let current = null;
    let hintOn = false;
    let recent = [];

    const navMul = document.getElementById("navMul");
    const navExp = document.getElementById("navExp");
    const mulCard = document.getElementById("mulCard");
    const expCard = document.getElementById("expCard");
    const digitsA = document.getElementById("digitsA");
    const digitsB = document.getElementById("digitsB");
    const mulNew = document.getElementById("mulNew");
    const mulProblem = document.getElementById("mulProblem");
    const mulTimer = document.getElementById("mulTimer");
    const mulAns = document.getElementById("mulAns");
    const mulSubmit = document.getElementById("mulSubmit");
    const mulResult = document.getElementById("mulResult");
    const expBase = document.getElementById("expBase");
    const expNMin = document.getElementById("expNMin");
    const expNMax = document.getElementById("expNMax");
    const expNew = document.getElementById("expNew");
    const expProblem = document.getElementById("expProblem");
    const expTimer = document.getElementById("expTimer");
    const expAns = document.getElementById("expAns");
    const expSubmit = document.getElementById("expSubmit");
    const expResult = document.getElementById("expResult");
    const logHint = document.getElementById("logHint");
    const toggleLogHint = document.getElementById("toggleLogHint");
    const historyBox = document.getElementById("history");
    const graphBars = document.getElementById("graphBars");

    function startTimer(el) {
      start = performance.now();
      if (timer) clearInterval(timer);
      timer = setInterval(() => {
        const s = (performance.now() - start) / 1000;
        el.textContent = "시간: " + s.toFixed(2) + "초";
      }, 60);
    }
    function stopTimer() { if (timer) clearInterval(timer); timer = null; }

    function randNDigits(d) {
      d = Math.max(1, d);
      if (d === 1) return Math.floor(Math.random() * 9) + 1;
      const min = Math.pow(10, d - 1);
      const max = Math.pow(10, d) - 1;
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function updateGraph() {
      graphBars.innerHTML = "";
      recent.forEach(ok => {
        const bar = document.createElement("div");
        bar.className = "bar " + (ok ? "correct" : "wrong");
        graphBars.appendChild(bar);
      });
    }

    function addHistoryItem(text, ok) {
      const div = document.createElement("div");
      div.className = "history-item " + (ok ? "correct" : "wrong");
      div.textContent = text;
      historyBox.appendChild(div);
      historyBox.scrollTop = historyBox.scrollHeight;
      recent.push(ok);
      if (recent.length > 30) recent.shift();
      updateGraph();
    }

    function triggerNewProblem() {
      if (mode === "mul") mulNew.click();
      else expNew.click();
    }

    navMul.addEventListener("click", () => {
      mode = "mul";
      navMul.classList.add("active");
      navExp.classList.remove("active");
      mulCard.style.display = "";
      expCard.style.display = "none";
    });

    navExp.addEventListener("click", () => {
      mode = "exp";
      navExp.classList.add("active");
      navMul.classList.remove("active");
      mulCard.style.display = "none";
      expCard.style.display = "";
    });

    mulNew.addEventListener("click", () => {
      const a = randNDigits(parseInt(digitsA.value || "2"));
      const b = randNDigits(parseInt(digitsB.value || "2"));
      current = { type: "mul", a, b };
      mulProblem.textContent = `${a} × ${b} = ?`;
      mulResult.textContent = "";
      mulAns.value = "";
      stopTimer();
      startTimer(mulTimer);
      mulAns.focus();
    });

    mulSubmit.addEventListener("click", () => {
      if (!current || current.type !== "mul") return;
      stopTimer();
      const ans = Number(mulAns.value.trim().replace(/,/g, ""));
      const correct = current.a * current.b;
      const ok = ans === correct;
      mulResult.textContent = `정답: ${correct.toLocaleString()} ${ok ? '· 정답' : '· 오답'}`;
      mulResult.className = "result " + (ok ? "correct" : "wrong");
      addHistoryItem(`곱셈 ${current.a}×${current.b} = ${ans}`, ok);
    });

    expNew.addEventListener("click", () => {
      const base = parseInt(expBase.value);
      let nMin = parseInt(expNMin.value || "1");
      let nMax = parseInt(expNMax.value || "10");
      const n = Math.floor(Math.random() * (nMax - nMin + 1)) + nMin;
      current = { type: "exp", base, n };
      expProblem.textContent = `${base}^${n} = ?`;
      expResult.textContent = "";
      expAns.value = "";
      stopTimer();
      startTimer(expTimer);
      if (hintOn) logHint.textContent = `자릿수 힌트: log10(${base}) ≈ ${base==2?0.301:0.477} → (${base==2?0.301:0.477}×${n})+1`;
      expAns.focus();
    });

    expSubmit.addEventListener("click", () => {
      if (!current || current.type !== "exp") return;
      stopTimer();
      const ans = Number(expAns.value.trim().replace(/,/g, ""));
      const correct = Math.pow(current.base, current.n);
      const ok = ans === correct;
      expResult.textContent = `정답: ${correct.toLocaleString()} ${ok ? '· 정답' : '· 오답'}`;
      expResult.className = "result " + (ok ? "correct" : "wrong");
      addHistoryItem(`지수 ${current.base}^${current.n} = ${ans}`, ok);
    });

    toggleLogHint.addEventListener("click", () => {
      hintOn = !hintOn;
      toggleLogHint.textContent = hintOn ? "로그 힌트 끄기" : "로그 힌트 켜기";
    });

    mulAns.addEventListener("keydown", (e) => { if (e.key === "Enter") mulSubmit.click(); });
    mulAns.addEventListener("input", () => { if (mulAns.value.endsWith(" ")) { mulAns.value = mulAns.value.trimEnd(); triggerNewProblem(); } });
    expAns.addEventListener("keydown", (e) => { if (e.key === "Enter") expSubmit.click(); });
    expAns.addEventListener("input", () => { if (expAns.value.endsWith(" ")) { expAns.value = expAns.value.trimEnd(); triggerNewProblem(); } });

    document.addEventListener("keydown", (e) => {
      if ((e.code === "Space" || e.key === " ") && document.activeElement.tagName !== 'INPUT') {
        e.preventDefault();
        triggerNewProblem();
      }
    });
  </script>
</body>
</html>
