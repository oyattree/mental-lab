<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mental Lab v1.8.7 - Logic First</title>
  <style>
    :root { 
      --bg: #0d1117; --card: #161b22; --border: #30363d; 
      --primary: #58a6ff; --success: #238636; --danger: #da3633;
      --text: #e5e7eb; --muted: #8b949e;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
    
    /* 슬로건 헤더 */
    .slogan-header { text-align: center; padding: 15px 10px 5px; background: #161b22; border-bottom: 1px solid #30363d; flex: 0 0 auto; }
    .slogan-header h1 { font-size: 1.1rem; font-weight: 700; margin: 0; color: #8b949e; letter-spacing: 0.5px; }
    .slogan-header span { color: var(--primary); }

    /* Navigation */
    .nav { display: flex; gap: 8px; padding: 12px; background: #161b22; border-bottom: 1px solid #30363d; flex: 0 0 auto; justify-content: center; align-items: center; }
    .nav button { padding: 6px 12px; border-radius: 6px; border: 1px solid #30363d; background: #21262d; color: #c9d1d9; cursor: pointer; font-size: 0.85rem; font-weight: 600; white-space: nowrap; transition: 0.2s; }
    .nav button.active { background: var(--primary); color: #ffffff; border-color: var(--primary); }
    #toggleSidebar { background: var(--success); color: white; border: none; }

    .main-container { display: flex; flex: 1; position: relative; overflow: hidden; width: 100%; justify-content: center; }

    /* 사이드바 오버레이 (초기 open 상태 고려) */
    .formula-sidebar { position: absolute; left: 0; top: 0; width: 280px; height: 100%; background: #0d1117; border-right: 1px solid #30363d; padding: 15px; overflow-y: auto; transition: transform 0.3s ease; z-index: 2000; transform: translateX(-100%); box-shadow: 10px 0 20px rgba(0,0,0,0.5); }
    .formula-sidebar.open { transform: translateX(0); }
    .formula-group h3 { color: #8b949e; border-bottom: 1px solid #30363d; padding-bottom: 5px; margin-top: 15px; font-size: 0.9rem; text-transform: uppercase; }
    .formula-item { background: #161b22; padding: 8px; border-radius: 6px; margin-bottom: 6px; font-family: monospace; color: #58a6ff; border: 1px solid #30363d; font-size: 0.85rem; line-height: 1.4; }

    /* 연습 공간 중앙 정렬 */
    .content { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; width: 100%; }
    .card { width: 100%; max-width: 500px; background: #161b22; padding: 20px; border-radius: 12px; border: 1px solid #30363d; margin-bottom: 15px; position: relative; }
    .card h2 { margin: 0 0 12px; font-size: 1.2rem; text-align: center; color: #8b949e; letter-spacing: 1.5px; }
    
    .row { display: flex; gap: 10px; margin-bottom: 12px; align-items: flex-end; justify-content: center; }
    .row label { font-size: 0.75rem; display: flex; flex-direction: column; gap: 4px; color: #8b949e; }
    .row input, .row select { padding: 8px; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: #c9d1d9; font-size: 0.85rem; text-align: center; }

    #digitsA, #digitsB { width: 130px; }
    #expNMin, #expNMax { width: 80px; }
    #geoMax { width: 100px; }

    /* 버튼 그룹 */
    .btn-group { display: flex; flex-direction: column; gap: 4px; }
    .btn-action { min-width: 90px; padding: 8px 16px; border-radius: 6px; font-weight: bold; cursor: pointer; border: none; color: white; text-align: center; }
    .btn-new { background: var(--success); font-size: 0.9rem; }
    .btn-stop { background: var(--danger); font-size: 0.75rem; }

    .triangle-viz { width: 100px; height: 80px; margin: 0 auto 10px; }
    .triangle-viz svg { width: 100%; height: 100%; opacity: 0.8; }

    .problem { font-size: 3.2rem; font-weight: 800; text-align: center; margin: 15px 0 5px; color: #f0f6fc; min-height: 1.2em; }
    .timer { font-size: 1rem; text-align: center; color: #484f58; margin-bottom: 15px; font-family: monospace; }
    
    .answer-row { width: 100%; display: flex; justify-content: center; }
    .answer-row input { width: 100%; max-width: 320px; padding: 12px; border-radius: 10px; border: 2px solid #30363d; background: #0d1117; color: #ffffff; font-size: 2.2rem; text-align: center; outline: none; transition: 0.2s; }
    .answer-row input:focus { border-color: #58a6ff; }
    .answer-row input:disabled { opacity: 0.5; }

    .result { text-align: center; min-height: 1.5em; font-size: 1.1rem; font-weight: bold; margin-top: 10px; }
    .result.correct { color: #39d353; }
    .result.wrong { color: #f85149; }

    .history { width: 100%; max-width: 500px; background: #161b22; border-radius: 12px 12px 0 0; padding: 12px; border: 1px solid #30363d; border-bottom: none; height: 120px; overflow-y: auto; font-size: 0.85rem; }
    .graph { width: 100%; max-width: 500px; padding: 10px; background: #161b22; border-radius: 0 0 12px 12px; border: 1px solid #30363d; margin-bottom: 30px; }
    .graph-bars { display: flex; gap: 3px; align-items: flex-end; min-height: 25px; justify-content: center; }
    .bar { width: 8px; height: 20px; background: #30363d; border-radius: 1px; }
  </style>
</head>
<body>

  <div class="slogan-header">
    <h1>Log out from <span>reality</span>, Log in to <span>logic</span>.</h1>
  </div>

  <div class="nav">
    <button id="navMul" class="active">Multiplication</button>
    <button id="navExp">Exponential</button>
    <button id="navGeo">Pythagorean Triples</button>
    <button id="toggleSidebar" onclick="toggleSidebar()">Formulas</button>
  </div>

  <div class="main-container">
    <div class="formula-sidebar open" id="sidebar">
      <div class="formula-group">
        <h3>Algebraic</h3>
        <div class="formula-item">a(b±1) = ab ± a</div>
        <div class="formula-item">a²-b² = (a+b)(a-b)</div>
      </div>
      <div class="formula-group">
        <h3>Pythagorean</h3>
        <div class="formula-item"><b>Odd a:</b><br>b = (a²-1)/2, c = b+1</div>
        <div class="formula-item"><b>Even a:</b><br>b = (a/2)²-1, c = b+2</div>
      </div>
      <div class="formula-group">
        <h3>Scales</h3>
        <div class="formula-item">log₂2 ≈ 0.3, log₂3 ≈ 0.48</div>
        <div class="formula-item">2¹⁰ = 1024</div>
      </div>
      <button onclick="toggleSidebar()" style="width:100%; margin-top:20px; background:#30363d; color:#fff; border:none; padding:8px; border-radius:4px; cursor:pointer;">Close</button>
    </div>

    <div class="content">
      <div id="mulCard" class="card">
        <h2>Multiplication</h2>
        <div class="row">
          <label>L <input type="number" id="digitsA" value="2" /></label>
          <label>R <input type="number" id="digitsB" value="2" /></label>
          <div class="btn-group">
            <button id="mulNew" class="btn-action btn-new" onclick="startProblem()">NEW</button>
            <button class="btn-action btn-stop" onclick="handleStop('mul')">STOP</button>
          </div>
        </div>
        <div class="problem" id="mulProblem">READY</div>
        <div class="timer" id="mulTimer">0.00s</div>
        <div class="answer-row"><input type="text" id="mulAns" placeholder="?" inputmode="numeric" disabled /></div>
        <div class="result" id="mulResult"></div>
      </div>

      <div id="expCard" class="card" style="display:none;">
        <h2>Exponential</h2>
        <div class="row">
          <select id="expBase"><option value="2">2ⁿ</option><option value="3">3ⁿ</option><option value="5">5ⁿ</option></select>
          <label>min <input type="number" id="expNMin" value="1" /></label>
          <label>max <input type="number" id="expNMax" value="10" /></label>
          <div class="btn-group">
            <button id="expNew" class="btn-action btn-new" onclick="startProblem()">NEW</button>
            <button class="btn-action btn-stop" onclick="handleStop('exp')">STOP</button>
          </div>
        </div>
        <div class="problem" id="expProblem">READY</div>
        <div class="timer" id="expTimer">0.00s</div>
        <div class="answer-row"><input type="text" id="expAns" placeholder="?" inputmode="numeric" disabled /></div>
        <div class="result" id="expResult"></div>
      </div>

      <div id="geoCard" class="card" style="display:none;">
        <h2>Pythagorean Triples</h2>
        <div class="triangle-viz">
          <svg viewBox="0 0 120 100">
            <path d="M 30 20 L 30 80 L 100 80 Z" fill="none" stroke="#58a6ff" stroke-width="3" />
            <text x="15" y="55" fill="#8b949e" font-size="16">a</text>
            <text x="60" y="95" fill="#8b949e" font-size="16">b</text>
            <text x="70" y="45" fill="#58a6ff" font-size="16">c</text>
          </svg>
        </div>
        <div class="row">
          <select id="geoMode"><option value="odd">Odd</option><option value="even">Even</option></select>
          <label>max-a <input type="number" id="geoMax" value="20" /></label>
          <div class="btn-group">
            <button id="geoNew" class="btn-action btn-new" onclick="startProblem()">NEW</button>
            <button class="btn-action btn-stop" onclick="handleStop('geo')">STOP</button>
          </div>
        </div>
        <div class="problem" id="geoProblem">READY</div>
        <div class="timer" id="geoTimer">0.00s</div>
        <div class="answer-row"><input type="text" id="geoAns" placeholder="b, c" inputmode="text" disabled /></div>
        <div class="result" id="geoResult"></div>
      </div>

      <div class="history" id="historyBox"></div>
      <div class="graph"><div class="graph-bars" id="graphBars"></div></div>
    </div>
  </div>

  <script>
    let state = { mode: 'mul', active: false, timer: null, start: 0, current: null, recent: [] };
    
    function getUI(p) {
      return {
        prob: document.getElementById(p + "Problem"),
        timer: document.getElementById(p + "Timer"),
        ans: document.getElementById(p + "Ans"),
        res: document.getElementById(p + "Result")
      };
    }

    function toggleSidebar() { document.getElementById("sidebar").classList.toggle("open"); }

    function startProblem() {
      const u = getUI(state.mode);
      state.active = true;
      u.ans.disabled = false;
      u.ans.value = ""; u.res.textContent = ""; u.ans.focus();
      
      if (state.mode === 'mul') {
        const da = parseInt(document.getElementById("digitsA").value) || 2;
        const db = parseInt(document.getElementById("digitsB").value) || 2;
        const a = randND(da); const b = randND(db);
        state.current = { q: `${a} × ${b}`, a: (a * b).toString() };
      } else if (state.mode === 'exp') {
        const b = parseInt(document.getElementById("expBase").value); 
        const min = parseInt(document.getElementById("expNMin").value);
        const max = parseInt(document.getElementById("expNMax").value);
        const n = Math.floor(Math.random() * (max - min + 1)) + min;
        state.current = { q: `${b}^${n}`, a: Math.pow(b, n).toString() };
      } else {
        const m = document.getElementById("geoMode").value;
        const max = parseInt(document.getElementById("geoMax").value);
        const a = (m === 'odd') ? randOdd(3, max) : randEven(4, max);
        const b = (a % 2 !== 0) ? (a*a - 1)/2 : Math.pow(a/2, 2) - 1;
        const c = (a % 2 !== 0) ? b + 1 : b + 2;
        state.current = { q: `a = ${a}`, a: `${b},${c}` };
      }
      u.prob.textContent = state.current.q;
      runTimer(u.timer);
    }

    function checkAnswer() {
      if (!state.active || !state.current) return;
      clearInterval(state.timer);
      state.active = false;
      const u = getUI(state.mode);
      const val = u.ans.value.trim().replace(/ /g, "");
      const ok = (val.replace(/,/g, "") === state.current.a.replace(/,/g, ""));
      u.res.textContent = ok ? "✓ Correct" : `✗ Answer: ${state.current.a}`;
      u.res.className = "result " + (ok ? "correct" : "wrong");
      logHistory(`[${state.mode.toUpperCase()}] ${state.current.q} = ${val}`, ok);
      state.current = null;
    }

    function handleStop(prefix) {
      clearInterval(state.timer);
      const u = getUI(prefix);
      u.ans.disabled = true; u.ans.value = "";
      u.prob.textContent = "STOPPED"; u.timer.textContent = "0.00s";
      state.active = false; state.current = null;
    }

    function runTimer(el) {
      state.start = performance.now();
      if(state.timer) clearInterval(state.timer);
      state.timer = setInterval(() => {
        el.textContent = ((performance.now() - state.start)/1000).toFixed(2) + "s";
      }, 60);
    }

    function randND(d) { return Math.floor(Math.random() * (Math.pow(10, d) - Math.pow(10, d-1))) + Math.pow(10, d-1); }
    function randOdd(min, max) { let n = Math.floor(Math.random() * (max-min+1)) + min; return n%2!==0?n:(n+1>max?n-1:n+1); }
    function randEven(min, max) { let n = Math.floor(Math.random() * (max-min+1)) + min; return n%2===0?n:(n+1>max?n-1:n+1); }

    const navs = { mul: document.getElementById("navMul"), exp: document.getElementById("navExp"), geo: document.getElementById("navGeo") };
    const cards = { mul: document.getElementById("mulCard"), exp: document.getElementById("expCard"), geo: document.getElementById("geoCard") };

    Object.keys(navs).forEach(k => {
      navs[k].onclick = () => {
        state.mode = k;
        Object.keys(navs).forEach(x => navs[x].classList.toggle("active", x === k));
        Object.keys(cards).forEach(x => cards[x].style.display = (x === k ? "" : "none"));
        handleStop(k);
      };
    });

    ["mul", "exp", "geo"].forEach(p => {
      const input = document.getElementById(p + "Ans");
      input.onkeydown = (e) => { if(e.key==='Enter') { if(state.active) checkAnswer(); else startProblem(); }};
      input.oninput = (e) => { if(e.target.value.endsWith("  ")) { e.target.value = e.target.value.trim(); startProblem(); } };
    });

    function logHistory(text, ok) {
      const div = document.createElement("div");
      div.style.color = ok ? "#39d353" : "#f85149";
      div.style.borderLeft = `3px solid ${ok ? '#39d353' : '#f85149'}`;
      div.style.paddingLeft = "5px";
      div.textContent = text;
      document.getElementById("historyBox").prepend(div);
      state.recent.push({ok});
      if(state.recent.length > 30) state.recent.shift();
      updateGraph();
    }

    function updateGraph() {
      const bars = document.getElementById("graphBars");
      bars.innerHTML = "";
      state.recent.forEach(item => {
        const bar = document.createElement("div");
        bar.className = "bar";
        bar.style.background = item.ok ? "#39d353" : "#f85149";
        bars.appendChild(bar);
      });
    }

    document.onkeydown = (e) => {
      if ((e.code === "Space") && document.activeElement.tagName !== 'INPUT') {
        e.preventDefault(); startProblem();
      }
    };
  </script>
</body>
</html>
